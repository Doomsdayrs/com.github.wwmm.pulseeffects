{
  "app-id": "com.github.wwmm.pulseeffects",
  "runtime": "org.gnome.Platform",
  "runtime-version": "3.26",
  "sdk": "org.gnome.Sdk",
  "sdk-extensions": ["org.freedesktop.Sdk.Extension.gfortran-62"],
  "command": "pulseeffects",
  "rename-icon": "pulseeffects",
  "finish-args": [
    /* Wayland access */
    "--socket=wayland",
    /* Sound access */
    "--socket=pulseaudio",
    /* X11 + XShm access */
    "--share=ipc", "--socket=x11",
    /* Dconf access*/
    "--env=DCONF_USER_CONFIG_DIR=.config/dconf",
    "--filesystem=xdg-run/dconf",
    "--filesystem=~/.config/dconf:ro",
    "--talk-name=ca.desrt.dconf",
    /* LV2 Plugin PATH */
    "--env=LV2_PATH=/app/lib/lv2"
  ],
  "cleanup": [
    "*.a",
    "*.h",
    "*.la",
    "/include",
    "/lib/pkgconfig"
  ],
  "modules": [
    {
      "name": "pulseeffects",
      "buildsystem": "meson",
      "builddir": true,
      "sources": [{
        "type": "git",
        "url": "https://github.com/wwmm/pulseeffects.git",
        "tag": "v3.2.0",
        "commit": "14f6e8ac46773311a114d7edc178833d41ea6a99"
      }],
      "post-install": [
        "install -Dm644 ../LICENSE.md /app/share/licenses/com.github.wwmm.pulseeffects/LICENSE"
      ],
      "modules": [
        {
          "name": "gfortran",
          "buildsystem": "simple",
          "build-commands": [
            "mkdir -p /app/lib",
            "cp -d /usr/lib/sdk/gfortran-62/lib/libquadmath.so* /usr/lib/sdk/gfortran-62/lib/libgfortran.so* /app/lib"
          ]
        },
        {
          "name": "lapack",
          "buildsystem": "cmake",
          "builddir": true,
          "config-opts": [
            "-DCMAKE_INSTALL_PREFIX=/app",
            "-DCMAKE_INSTALL_LIBDIR=lib",
            "-DCMAKE_BUILD_TYPE=Release",
            "-DBUILD_SHARED_LIBS=ON",
            "-DBUILD_TESTING=OFF",
            "-DCMAKE_Fortran_COMPILER=/usr/lib/sdk/gfortran-62/bin/gfortran",
            "-DLAPACKE=ON",
            "-DCBLAS=ON"
          ],
          "sources": [{
            "type": "git",
            "url": "https://github.com/Reference-LAPACK/lapack-release",
            "branch": "lapack-3.8.0",
            "commit": "ba3779a6813d84d329b73aac86afc4e041170609"
          }],
          "post-install": [
            "install -Dm644 ../LICENSE /app/share/licenses/lapack/LICENSE"
          ],
          "cleanup": [ "/lib/cmake" ]
        },
        {
          "name": "numpy",
          "buildsystem": "simple",
          "build-commands": [
            "PATH=$PATH:/usr/lib/sdk/gfortran-62/bin python3 setup.py build -j 0",
            "python3 setup.py install --prefix=/app --root=/ --optimize=1"
          ],
          "build-options": {
            "env": { "ATLAS": "None", "BLAS": "/app/lib", "LAPACK": "/app/lib" }
          },
          "sources": [{
            "type": "archive",
            "url": "https://github.com/numpy/numpy/releases/download/v1.14.0/numpy-1.14.0.tar.gz",
            "sha256": "c45d99134bb07600e916537c51c22e87f9e0c44b05d71018ab4907e195f007ce"
          }],
          "post-install": [
            "install -Dm644 LICENSE.txt /app/share/licenses/numpy/LICENSE"
          ],
          "cleanup": [ "*.h", "/bin", "libnpymath.a", "*/core/include" ]
        },
        {
          "name": "scipy",
          "buildsystem": "simple",
          "build-commands": [
            "PATH=$PATH:/usr/lib/sdk/gfortran-62/bin python3 setup.py build -j 0",
            "python3 setup.py install --prefix=/app --root=/ --optimize=1"
          ],
          "build-options": {
            "ldflags": "-shared",
            "env": { "ATLAS": "None", "BLAS": "/app/lib", "LAPACK": "/app/lib" }
          },
          "sources": [{
            "type": "archive",
            "url": "https://github.com/scipy/scipy/releases/download/v1.0.0/scipy-1.0.0.tar.xz",
            "sha256": "06b23f2a5db5418957facc86ead86b7752147c0461f3156f88a3da87f3dc6739"
          }],
          "post-install": [
            "install -Dm644 LICENSE.txt /app/share/licenses/scipy/LICENSE"
          ]
        },
        {
          "name": "gst-plugins-bad",
          "config-opts": [
            "--disable-accurip",
            "--disable-adpcmdec",
            "--disable-adpcmenc",
            "--disable-aiff",
            "--disable-videoframe_audiolevel",
            "--disable-asfmux",
            "--disable-audiobuffersplit",
            "--disable-audiofxbad",
            "--disable-audiomixer",
            "--disable-audiomixmatrix",
            "--disable-compositor",
            "--disable-audiovisualizers",
            "--disable-autoconvert",
            "--disable-bayer",
            "--disable-camerabin2",
            "--disable-coloreffects",
            "--disable-debugutils",
            "--disable-dvbsuboverlay",
            "--disable-dvdspu",
            "--disable-faceoverlay",
            "--disable-festival",
            "--disable-fieldanalysis",
            "--disable-freeverb",
            "--disable-frei0r",
            "--disable-gaudieffects",
            "--disable-geometrictransform",
            "--disable-gdp",
            "--disable-id3tag",
            "--disable-inter",
            "--disable-interlace",
            "--disable-ivfparse",
            "--disable-ivtc",
            "--disable-jp2kdecimator",
            "--disable-jpegformat",
            "--disable-librfb",
            "--disable-midi",
            "--disable-mpegdemux",
            "--disable-mpegtsdemux",
            "--disable-mpegtsmux",
            "--disable-mpegpsmux",
            "--disable-mxf",
            "--disable-netsim",
            "--disable-onvif",
            "--disable-pcapparse",
            "--disable-pnm",
            "--disable-rawparse",
            "--disable-removesilence",
            "--disable-sdp",
            "--disable-segmentclip",
            "--disable-siren",
            "--disable-smooth",
            "--disable-speed",
            "--disable-subenc",
            "--disable-stereo",
            "--disable-timecode",
            "--disable-videofilters",
            "--disable-videoparsers",
            "--disable-videosignal",
            "--disable-vmnc",
            "--disable-y4m",
            "--disable-yadif",
            "--disable-directsound",
            "--disable-wasapi",
            "--disable-direct3d",
            "--disable-winscreencap",
            "--disable-winks",
            "--disable-android_media",
            "--disable-apple_media",
            "--disable-bluez",
            "--disable-avc",
            "--disable-shm",
            "--disable-vcd",
            "--disable-opensles",
            "--disable-uvch264",
            "--disable-nvenc",
            "--disable-tinyalsa",
            "--disable-msdk",
            "--disable-assrender",
            "--disable-voamrwbenc",
            "--disable-voaacenc",
            "--disable-bz2",
            "--disable-chromaprint",
            "--disable-curl",
            "--disable-dash",
            "--disable-dc1394",
            "--disable-decklink",
            "--disable-directfb",
            "--disable-wayland",
            "--disable-webp",
            "--disable-daala",
            "--disable-dts",
            "--disable-resindvd",
            "--disable-faac",
            "--disable-faad",
            "--disable-fbdev",
            "--disable-fdk_aac",
            "--disable-flite",
            "--disable-gsm",
            "--disable-fluidsynth",
            "--disable-kate",
            "--disable-kms",
            "--disable-libde265",
            "--disable-libmms",
            "--disable-srtp",
            "--disable-dtls",
            "--disable-ttml",
            "--disable-modplug",
            "--disable-mpeg2enc",
            "--disable-mplex",
            "--disable-musepack",
            "--disable-neon",
            "--disable-ofa",
            "--disable-openal",
            "--disable-opencv",
            "--disable-openexr",
            "--disable-openh264",
            "--disable-openjpeg",
            "--disable-openni2",
            "--disable-opus",
            "--disable-rsvg",
            "--disable-gl",
            "--disable-gtk3",
            "--disable-qt",
            "--disable-vulkan",
            "--disable-teletextdec",
            "--disable-wildmidi",
            "--disable-smoothstreaming",
            "--disable-sndfile",
            "--disable-soundtouch",
            "--disable-spc",
            "--disable-gme",
            "--disable-dvb",
            "--disable-acm",
            "--disable-vdpau",
            "--disable-sbc",
            "--disable-schro",
            "--disable-zbar",
            "--disable-rtmp",
            "--disable-spandsp",
            "--disable-hls",
            "--disable-x265",
            "--disable-webrtcdsp"
          ],
          "sources": [
            {
              "type": "archive",
              "url": "https://gstreamer.freedesktop.org/src/gst-plugins-bad/gst-plugins-bad-1.12.4.tar.xz",
              "sha256": "0c7857be16686d5c1ba6e34bd338664d3d4599d32714a8eca5c8a41a101e2d08"
            }
          ],
          "post-install": [
            "install -Dm644 COPYING /app/share/licenses/gst-plugins-bad/COPYING",
            "install -m644 COPYING.LIB /app/share/licenses/gst-plugins-bad"
          ],
          "cleanup": [
            "/lib/girepository-1.0",
            "/lib/gstreamer-1.0/include",
            "/share/gir-1.0",
            "/share/gtk-doc"
          ],
          "modules": [
            /* LADSPA Plugins */
            {
              "name": "ladspa-sdk",
              "make-args": [ "targets" ],
              "make-install-args": [
                "INSTALL_BINARY_DIR=/app/bin",
                "INSTALL_INCLUDE_DIR=/app/include",
                "INSTALL_PLUGINS_DIR=/app/lib/ladspa"
              ],
              "no-autogen": true,
              "subdir": "src",
              "sources": [
                {
                  "type": "archive",
                  "url": "http://www.ladspa.org/download/ladspa_sdk_1.13.tgz",
                  "sha256": "b5ed3f4f253a0f6c1b7a1f4b8cf62376ca9f51d999650dd822650c43852d306b"
                },
                {
                  "type": "patch",
                  "path": "ladspa-sdk-fix-memleak.patch",
                  "strip-components": 0
                },
                {
                  "type": "shell",
                  "commands": [ "sed -i 's|mkdirhier|mkdir -p|' src/makefile" ]
                }
              ],
              "cleanup": [ "*" ]
            },
            {
              /* Single precision */
              "name": "fftw3f",
              "config-opts": [
                "--prefix=/app",
                "--enable-shared",
                "--enable-threads",
                "--enable-openmp",
                "--disable-doc",
                "--enable-sse",
                "--enable-avx",
                "--enable-float"
              ],
              "build-options": {
                "arch": {
                  "x86_64": {
                    "cflags": "-fPIC",
                    "cxxflags": "-fPIC"
                  }
                }
              },
              "sources": [{
                "type": "archive",
                "url": "http://www.fftw.org/fftw-3.3.7.tar.gz",
                "md5": "0d5915d7d39b3253c1cc05030d79ac47"
              }],
              "post-install": [
                "install -Dm644 COPYING /app/share/licenses/fftw/COPYING",
                "install -m644 COPYRIGHT /app/share/licenses/fftw/COPYRIGHT"
              ],
              "cleanup": [ "/bin", "/share/man" ]
            },
            {
              "name": "swh-plugins",
              "config-opts": [ "--prefix=/app" ],
              "sources": [
                {
                  "type": "git",
                  "url": "https://github.com/swh/ladspa.git",
                  "tag": "v0.4.17",
                  "commit": "8b50f3434b8b30dff16020d17608ced9ee04477b"
                },
                {
                  "type": "patch",
                  "path": "swh-plugins-disable-unused.patch"
                }
              ],
              "post-install": [
                "install -Dm644 COPYING /app/share/licenses/swh-plugins/COPYING"
              ],
              "cleanup": [ "/share/ladspa" ]
            },
            {
              "name": "rubberband",
              "sources": [{
                "type": "archive",
                "url": "https://bitbucket.org/breakfastquay/rubberband/get/v1.8.1.tar.gz",
                "sha256": "9bea85fc2e4d8c3044e3b87c6ecff4282a61a888bafe0ce07cee11fc0ea68f16"
              }],
              "post-install": [
                "install -Dm644 COPYING /app/share/licenses/rubberband/COPYING"
              ],
              "cleanup": [ "/bin", "/share/ladspa" ],
              "modules": [
                {
                  /* Double precision */
                  "name": "fftw3",
                  "config-opts": [
                    "--prefix=/app",
                    "--enable-shared",
                    "--enable-threads",
                    "--enable-openmp",
                    "--disable-doc",
                    "--enable-sse2",
                    "--enable-avx"
                  ],
                  "build-options": {
                    "arch": {
                      "x86_64": {
                        "cflags": "-fPIC",
                        "cxxflags": "-fPIC"
                      }
                    }
                  },
                  "sources": [{
                    "type": "archive",
                    "url": "http://www.fftw.org/fftw-3.3.7.tar.gz",
                    "md5": "0d5915d7d39b3253c1cc05030d79ac47"
                  }],
                  "cleanup": [ "/bin", "/share/man" ]
                },
                {
                  "name": "vamp-plugin-sdk",
                  "sources": [{
                    "type": "git",
                    "url": "https://github.com/c4dm/vamp-plugin-sdk",
                    "tag": "vamp-plugin-sdk-v2.7.1",
                    "commit": "10be490c9902d874e9d772d94bf91448303d9b06"
                  }],
                  "post-install": [
                    "install -Dm644 COPYING /app/share/licenses/vamp-plugin-sdk/COPYING"
                  ],
                  "cleanup": [ "/bin" ]
                }
              ]
            },
            /* LV2 Plugins */
            {
              "name": "lv2",
              "buildsystem": "simple",
              "build-commands": [
                "python3 ./waf configure --prefix=/app --lv2dir=/app/lib/lv2",
                "python3 ./waf build -j 4",
                "python3 ./waf install"
              ],
              "sources": [{
                "type": "archive",
                "url": "http://lv2plug.in/spec/lv2-1.14.0.tar.bz2",
                "sha256": "b8052683894c04efd748c81b95dd065d274d4e856c8b9e58b7c3da3db4e71d32"
              }],
              "post-install": [
                "install -Dm644 COPYING /app/share/licenses/lv2/COPYING"
              ],
              "cleanup": [ "/bin", "/share/lv2specgen" ]
            },
            {
              "name": "lilv",
              "buildsystem": "simple",
              "build-commands": [
                "python3 ./waf configure --prefix=/app",
                "python3 ./waf build -j 4",
                "python3 ./waf install"
              ],
              "sources": [{
                "type": "archive",
                "url": "https://download.drobilla.net/lilv-0.24.2.tar.bz2",
                "sha256": "f7ec65b1c1f1734ded3a6c051bbaf50f996a0b8b77e814a33a34e42bce50a522"
              }],
              "post-install": [
                "install -Dm644 COPYING /app/share/licenses/lilv/COPYING"
              ],
              "cleanup": [ "/bin", "/etc", "/share/man" ],
              "modules": [
                {
                  "name": "serd",
                  "buildsystem": "simple",
                  "build-commands": [
                    "python3 ./waf configure --prefix=/app",
                    "python3 ./waf build -j 4",
                    "python3 ./waf install"
                  ],
                  "sources": [{
                    "type": "archive",
                    "url": "https://download.drobilla.net/serd-0.28.0.tar.bz2",
                    "sha256": "1df21a8874d256a9f3d51a18b8c6e2539e8092b62cc2674b110307e93f898aec"
                  }],
                  "post-install": [
                    "install -Dm644 COPYING /app/share/licenses/serd/COPYING"
                  ],
                  "cleanup": [ "/bin", "/share/man" ]
                },
                {
                  "name": "sord",
                  "buildsystem": "simple",
                  "build-commands": [
                    "python3 ./waf configure --prefix=/app",
                    "python3 ./waf build -j 4",
                    "python3 ./waf install"
                  ],
                  "sources": [{
                    "type": "archive",
                    "url": "https://download.drobilla.net/sord-0.16.0.tar.bz2",
                    "sha256": "9d3cb2c9966e93f537f37377171f162023cea6784ca069699be4a7770c8a035a"
                  }],
                  "post-install": [
                    "install -Dm644 COPYING /app/share/licenses/sord/COPYING"
                  ],
                  "cleanup": [ "/bin", "/share/man" ]
                },
                {
                  "name": "sratom",
                  "buildsystem": "simple",
                  "build-commands": [
                    "python3 ./waf configure --prefix=/app",
                    "python3 ./waf build -j 4",
                    "python3 ./waf install"
                  ],
                  "sources": [{
                    "type": "archive",
                    "url": "https://download.drobilla.net/sratom-0.6.0.tar.bz2",
                    "sha256": "440ac2b1f4f0b7878f8b95698faa1e8f8c50929a498f68ec5d066863626a3d43"
                  }],
                  "post-install": [
                    "install -Dm644 COPYING /app/share/licenses/sratom/COPYING"
                  ]
                }
              ]
            },
            {
              "name": "calf",
              "sources": [{
                "type": "archive",
                "url": "https://calf-studio-gear.org/files/calf-0.90.0.tar.gz",
                "sha256": "2b32007c4769b0bcc9898c088d26562b1ab1d57a68130d0235e7d27da4d83236"
              }],
              "post-install": [
                "install -Dm644 COPYING /app/share/licenses/calf/COPYING"
              ],
              "cleanup": [ "/bin", "/share/applications", "/share/bash-completion",
                           "/share/calf", "/share/doc", "/share/man" ],
              "modules": [
                {
                  "name": "fluidsynth",
                  "buildsystem": "cmake",
                  "config-opts": [
                    "-DCMAKE_INSTALL_PREFIX=/app",
                    "-DCMAKE_INSTALL_LIBDIR=lib",
                    "-DCMAKE_BUILD_TYPE=Release",
                    "-Denable-ladspa=ON",
                    "-DLIB_SUFFIX=''"
                  ],
                  "sources": [{
                    "type": "git",
                    "url": "https://github.com/FluidSynth/fluidsynth.git",
                    "tag": "v1.1.8",
                    "commit": "12e7afe3a806a6b397f28e0ca4bc6bab9ebe7047"
                  }],
                  "post-install": [
                    "install -Dm644 LICENSE /app/share/licenses/fluidsynth/LICENSE"
                  ],
                  "cleanup": [ "/bin", "/share/man" ]
                }
              ]
            },
            {
              /* Ladspa versions are used by pulseeffects */
              "name": "zam-plugins",
              "no-autogen": true,
              "make-args": [ "PREFIX=/app", "PLUGINS=ZaMaximX2" ],
              "make-install-args": [ "PREFIX=/app", "PLUGINS=ZaMaximX2" ],
              "sources": [{
                "type": "git",
                "url": "https://github.com/zamaudio/zam-plugins.git",
                "tag": "3.9",
                "commit": "4976cf204074c1dfaf344821e83e8d896b35107d"
              }],
              "post-install": [
                "install -Dm644 LICENSE /app/share/licenses/zam-plugins/LICENSE"
              ],
              /* Note: gst-inspect-1.0 cannot find lv2 versions */
              "cleanup": [ "/lib/lv2", "/lib/vst" ]
            },
            {
              "name": "lsp-plugins",
              "no-autogen": true,
              "only-arches": [ "x86_64" ],
              "sources": [
                {
                  "type": "archive",
                  "url": "https://sourceforge.net/projects/lsp-plugins/files/scr/scr-1.0.4/lsp-plugins-src-scr-1.0.4.tar.gz",
                  "sha256": "29df4a42f029cde2036ce499a24b00854069a5f2da78940809d64094809e8bf8"
                },
                {
                  "type": "patch",
                  "path": "lsp-plugins.patch"
                }
              ],
              "post-install": [
                "install -Dm644 LICENSE.txt /app/share/licenses/lsp-plugins/LICENSE.txt"
              ]
            },
            /* Other Plugin Types */
            {
              "name": "bs2b",
              "sources": [{
                "type": "archive",
                "url": "https://downloads.sourceforge.net/sourceforge/bs2b/libbs2b-3.1.0.tar.gz",
                "sha256": "6aaafd81aae3898ee40148dd1349aab348db9bfae9767d0e66e0b07ddd4b2528"
              }],
              "post-install": [
                "install -Dm644 COPYING /app/share/licenses/bs2b/COPYING"
              ],
              "cleanup": [ "/bin" ]
            }
          ]
        }
      ]
    }
  ]
}
